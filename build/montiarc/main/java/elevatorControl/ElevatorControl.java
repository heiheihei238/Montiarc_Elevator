/* generated by template ma2java.component.CompilationUnit.ftl*/

/* (c) https://github.com/MontiCore/monticore */
/* generated by template ma2java.Package.ftl*/
package elevatorControl;

/* generated by template ma2java.Import.ftl*/
import java.util.List;
/* generated by template ma2java.Import.ftl*/
import java.lang.*;

/* generated by template ma2java.component.Component.ftl*/

/* generated by template ma2java.component.Header.ftl*/

public class ElevatorControl implements montiarc.rte.timesync.IComponent {

  private String instanceName = "";

  public void setInstanceName(String instanceName) {
    this.instanceName = instanceName;
  }

  public String getInstanceName() {
    return this.instanceName;
  }

  // ports
  /* generated by template ma2java.component.Port.ftl*/

  protected montiarc.rte.timesync.IInPort<java.util.List<java.lang.Boolean>> btn;

  public montiarc.rte.timesync.IInPort<java.util.List<java.lang.Boolean>> getBtn() {
    return this.btn;
  }

  public void setBtn(montiarc.rte.timesync.IInPort<java.util.List<java.lang.Boolean>> btn) {
    this.btn = btn;
  }

  /* generated by template ma2java.component.Port.ftl*/

  protected montiarc.rte.timesync.IOutPort<java.util.List<java.lang.Boolean>> light;

  public montiarc.rte.timesync.IOutPort<java.util.List<java.lang.Boolean>> getLight() {
    return this.light;
  }

  public void setLight(montiarc.rte.timesync.IOutPort<java.util.List<java.lang.Boolean>> light) {
    this.light = light;
  }

  /* generated by template ma2java.component.Port.ftl*/

  protected montiarc.rte.timesync.IInPort<java.util.List<java.lang.Boolean>> at;

  public montiarc.rte.timesync.IInPort<java.util.List<java.lang.Boolean>> getAt() {
    return this.at;
  }

  public void setAt(montiarc.rte.timesync.IInPort<java.util.List<java.lang.Boolean>> at) {
    this.at = at;
  }

  /* generated by template ma2java.component.Port.ftl*/

  protected montiarc.rte.timesync.IOutPort<java.lang.Boolean> open;

  public montiarc.rte.timesync.IOutPort<java.lang.Boolean> getOpen() {
    return this.open;
  }

  public void setOpen(montiarc.rte.timesync.IOutPort<java.lang.Boolean> open) {
    this.open = open;
  }

  /* generated by template ma2java.component.Port.ftl*/

  protected montiarc.rte.timesync.IOutPort<java.lang.Boolean> close;

  public montiarc.rte.timesync.IOutPort<java.lang.Boolean> getClose() {
    return this.close;
  }

  public void setClose(montiarc.rte.timesync.IOutPort<java.lang.Boolean> close) {
    this.close = close;
  }

  /* generated by template ma2java.component.Port.ftl*/

  protected montiarc.rte.timesync.IOutPort<java.lang.Boolean> up;

  public montiarc.rte.timesync.IOutPort<java.lang.Boolean> getUp() {
    return this.up;
  }

  public void setUp(montiarc.rte.timesync.IOutPort<java.lang.Boolean> up) {
    this.up = up;
  }

  /* generated by template ma2java.component.Port.ftl*/

  protected montiarc.rte.timesync.IOutPort<java.lang.Boolean> down;

  public montiarc.rte.timesync.IOutPort<java.lang.Boolean> getDown() {
    return this.down;
  }

  public void setDown(montiarc.rte.timesync.IOutPort<java.lang.Boolean> down) {
    this.down = down;
  }

  /* generated by template ma2java.component.Port.ftl*/

  protected montiarc.rte.timesync.IInPort<java.lang.Boolean> isOpen;

  public montiarc.rte.timesync.IInPort<java.lang.Boolean> getIsOpen() {
    return this.isOpen;
  }

  public void setIsOpen(montiarc.rte.timesync.IInPort<java.lang.Boolean> isOpen) {
    this.isOpen = isOpen;
  }

  /* generated by template ma2java.component.Port.ftl*/

  protected montiarc.rte.timesync.IInPort<java.lang.Boolean> isClosed;

  public montiarc.rte.timesync.IInPort<java.lang.Boolean> getIsClosed() {
    return this.isClosed;
  }

  public void setIsClosed(montiarc.rte.timesync.IInPort<java.lang.Boolean> isClosed) {
    this.isClosed = isClosed;
  }

  /* generated by template ma2java.component.Port.ftl*/

  protected montiarc.rte.timesync.IInPort<java.lang.Boolean> isObstacle;

  public montiarc.rte.timesync.IInPort<java.lang.Boolean> getIsObstacle() {
    return this.isObstacle;
  }

  public void setIsObstacle(montiarc.rte.timesync.IInPort<java.lang.Boolean> isObstacle) {
    this.isObstacle = isObstacle;
  }

  // parameters

  // variables

  public ElevatorControl() {}

  /* generated by template ma2java.component.Composed.ftl*/

  // subcomponents
  protected elevatorControl.ControlStation control;

  public elevatorControl.ControlStation getComponentControl() {
    return this.control;
  }

  protected elevatorControl.Elevator elevator;

  public elevatorControl.Elevator getComponentElevator() {
    return this.elevator;
  }

  protected java.util.List<montiarc.rte.timesync.IComponent> getAllSubcomponents() {
    return java.util.Arrays.asList(new montiarc.rte.timesync.IComponent[] {control, elevator});
  }

  @Override
  public void compute() {
    java.util.List<montiarc.rte.timesync.IComponent> notYetComputed =
        new java.util.ArrayList<>(getAllSubcomponents());
    while (notYetComputed.size() > 0) {
      java.util.Set<montiarc.rte.timesync.IComponent> computedThisIteration =
          new java.util.HashSet<>();
      for (montiarc.rte.timesync.IComponent subcomponent : notYetComputed) {
        if (subcomponent.isSynced()) {
          subcomponent.compute();
          computedThisIteration.add(subcomponent);
        }
      }
      if (computedThisIteration.isEmpty()) {
        throw new RuntimeException(
            "Could not complete compute cycle due to not all ports being synced. Likely reasons: Forgot to call init() or cyclic connector loop.");
      } else {
        notYetComputed.removeAll(computedThisIteration);
      }
    }
  }

  public void setUp() {
    this.btn =
        new montiarc.rte.timesync.InPort<>(
            !this.getInstanceName().isBlank() ? this.getInstanceName() + "." + "btn" : "btn");
    this.at =
        new montiarc.rte.timesync.InPort<>(
            !this.getInstanceName().isBlank() ? this.getInstanceName() + "." + "at" : "at");
    this.isOpen =
        new montiarc.rte.timesync.InPort<>(
            !this.getInstanceName().isBlank() ? this.getInstanceName() + "." + "isOpen" : "isOpen");
    this.isClosed =
        new montiarc.rte.timesync.InPort<>(
            !this.getInstanceName().isBlank()
                ? this.getInstanceName() + "." + "isClosed"
                : "isClosed");
    this.isObstacle =
        new montiarc.rte.timesync.InPort<>(
            !this.getInstanceName().isBlank()
                ? this.getInstanceName() + "." + "isObstacle"
                : "isObstacle");
    this.control = new elevatorControl.ControlStation();
    this.control.setInstanceName(
        !this.getInstanceName().isBlank() ? this.getInstanceName() + ".control" : "control");
    this.control.setUp();
    this.elevator = new elevatorControl.Elevator();
    this.elevator.setInstanceName(
        !this.getInstanceName().isBlank() ? this.getInstanceName() + ".elevator" : "elevator");
    this.elevator.setUp();
    this.btn.connect(control.getBtn());
    this.light = control.getLight();
    control.getReq().connect(elevator.getReq());
    this.at.connect(elevator.getAt());
    this.open = elevator.getOpen();
    this.close = elevator.getClose();
    this.up = elevator.getUp();
    this.down = elevator.getDown();
    elevator.getClear().connect(control.getClear());
    this.isOpen.connect(elevator.getIsOpen());
    this.isClosed.connect(elevator.getIsClosed());
    this.isObstacle.connect(elevator.getIsObstacle());
  }

  @Override
  public void init() {
    this.control.init();
    this.elevator.init();
  }

  @Override
  public void tick() {
    // update subcomponents
    this.control.tick();
    this.elevator.tick();
  }

  @Override
  public boolean isSynced() {
    return this.getBtn().isSynced()
        && this.getAt().isSynced()
        && this.getIsOpen().isSynced()
        && this.getIsClosed().isSynced()
        && this.getIsObstacle().isSynced();
  }
}
